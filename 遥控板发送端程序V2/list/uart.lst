C51 COMPILER V9.00   UART                                                                  07/02/2016 23:54:13 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\obj\uart.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE src\uart.c LARGE BROWSE ORDER INCDIR(.\inc) DEBUG OBJECTEXTEND PRINT(.\l
                    -ist\uart.lst) TABS(2) OBJECT(.\obj\uart.obj)

line level    source

   1          #include<stc12c5a60s2.h>
   2          #include "uart.h"
   3          /**************************************************************************
   4           - 功能描述：51单片机的串口初始化
   5           - 隶属模块：STC51串口操作
   6           - 函数属性：外部，使用户使用
   7           - 参数说明：无
   8           - 返回说明：无
   9           - 注：串口是一个最常用的调试查看信息方式，所以正确的初始化串口十分重要
  10           **************************************************************************/
  11          void uart_init(void)
  12          {
  13   1        PCON &= 0x7F;   //波特率不倍速
  14   1        SCON = 0x50;    //8位数据,可变波特率
  15   1        AUXR |= 0x04;   //独立波特率发生器时钟为Fosc,即1T
  16   1        BRT = 0xDC;   //设定独立波特率发生器重装值
  17   1        AUXR |= 0x01;   //串口1选择独立波特率发生器为波特率发生器
  18   1        AUXR |= 0x10;   //启动独立波特率发生器
  19   1          ES = 1;
  20   1        EA = 1;
  21   1        TI = 1;
  22   1      }
  23          /**************************************************************************
  24           - 功能描述：51单片机的串口发送字节的函数
  25           - 隶属模块：STC51串口操作
  26           - 函数属性：外部，使用户使用
  27           - 参数说明：val:要发送的一个字节
  28           - 返回说明：无
  29           - 注：发送一个字节，是串口发送的基础操作
  30           **************************************************************************/
  31          void UART1_SendOneChar(unsigned char val)   
  32          {   
  33   1          SBUF = val;   
  34   1          while(TI == 0);   
  35   1          TI = 0;         
  36   1      } 
  37          /**************************************************************************
  38           - 功能描述：51单片机的串口发送字符串
  39           - 隶属模块：STC51串口操作
  40           - 函数属性：外部，使用户使用
  41           - 参数说明：str:指向字符串的指针
  42           - 返回说明：无
  43           **************************************************************************/
  44          void UART1_SendString(unsigned char *str)
  45          {
  46   1        while(*str!='\0')
  47   1        {
  48   2           UART1_SendOneChar(*str);
  49   2           str++;
  50   2        }
  51   1      }
  52          
  53          /******************************************************************
  54           - 功能描述：将一个32位的变量dat转为字符串，比如把1234转为"1234"
C51 COMPILER V9.00   UART                                                                  07/02/2016 23:54:13 PAGE 2   

  55           - 隶属模块：公开函数模块
  56           - 函数属性：外部，用户可调用
  57           - 参数说明：dat:带转的long型的变量
  58                       str:指向字符数组的指针，转换后的字节串放在其中           
  59           - 返回说明：无
  60           ******************************************************************/
  61          void u32tostr(unsigned long dat,char *str) 
  62          {
  63   1       char xdata temp[20]={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
  64   1       unsigned char xdata i=0,j=0;
  65   1       i=0;
  66   1       while(dat)
  67   1       {
  68   2        temp[i]=dat%10+0x30;
  69   2        i++;
  70   2        dat/=10;
  71   2       }
  72   1       j=i;
  73   1       for(i=0;i<j;i++)
  74   1       {
  75   2        str[i]=temp[j-i-1];
  76   2       } 
  77   1       str[i]='\0';
  78   1      }
  79          
  80          /**************************************************************************
  81           - 功能描述：51单片机的串口发送数值
  82           - 隶属模块：STC51串口操作
  83           - 函数属性：外部，使用户使用
  84           - 参数说明：dat:要发送的数值
  85           - 返回说明：无
  86           - 注：函数中会将数值转为相应的字符串，发送出去。比如 4567 转为 "4567" 
  87           **************************************************************************/
  88          
  89          void UART_Put_Num(unsigned long dat)
  90          {
  91   1       char xdata temp[20]={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
  92   1       u32tostr(dat,temp);
  93   1       UART1_SendString(temp);
  94   1      }
  95          
  96          /**************************************************************************
  97           - 功能描述：51单片机的串口发送调试信息
  98           - 隶属模块：STC51串口操作
  99           - 函数属性：外部，使用户使用
 100           - 参数说明：inf:指向提示信息字符串的指针
 101                       dat:一个数值，前面的提示信息就是在说明这个数值的意义
 102           - 返回说明：无
 103           **************************************************************************/
 104          void UART_Put_Inf(char *inf,unsigned long dat)
 105          {
 106   1       UART1_SendString(inf);
 107   1       UART_Put_Num(dat);
 108   1       UART1_SendString("\n");  
 109   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    386    ----
   CONSTANT SIZE    =     42    ----
   XDATA SIZE       =   ----      57
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.00   UART                                                                  07/02/2016 23:54:13 PAGE 3   

   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
